<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Carrito en Tiempo Real</title>
    <style>
        ul { list-style: none; padding: 0; }
        li { margin-bottom: 10px; }
        button { margin: 5px 0; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Carrito en Tiempo Real</h1>

    <button id="createCart">üõí Crear nuevo carrito</button>

    <ul id="cartList">
    </ul>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const cartList = document.getElementById("cartList");


        document.getElementById("createCart").addEventListener("click", () => {
            socket.emit("createCart");
        });


        document.body.addEventListener("click", (e) => {
            if (e.target.classList.contains("add-to-cart")) {
                const cid = e.target.dataset.cid;
                const pid = e.target.dataset.pid;
                socket.emit("addProductToCart", { cid, pid });
            }

            if (e.target.classList.contains("remove-from-cart")) {
                const cid = e.target.dataset.cid;
                const pid = e.target.dataset.pid;
                socket.emit("removeProductFromCart", { cid, pid });
            }
        });


        socket.on("updateCarts", (carts) => {
            cartList.innerHTML = ""; 

            carts.forEach(cart => {
                const li = document.createElement("li");
                li.innerHTML = `
                    üõí <strong>Carrito:</strong> ${cart.id}
                    <ul>
                        ${cart.products.map(p => `
                            <li>
                                Producto: ${p.product} - Cantidad: ${p.quantity}
                                <button class="remove-from-cart" data-cid="${cart.id}" data-pid="${p.product}">‚ùå Quitar</button>
                            </li>
                        `).join("")}
                    </ul>
                    <button class="add-to-cart" data-cid="${cart.id}" data-pid="Azaleadoble">Agregar Azalea Doble</button>
                    <button class="add-to-cart" data-cid="${cart.id}" data-pid="Calistemo">Agregar Calistemo</button>
                    <button class="add-to-cart" data-cid="${cart.id}" data-pid="Arce">Agregar Arce</button>
                    <button class="add-to-cart" data-cid="${cart.id}" data-pid="Azaleadoble">Agregar Jazm√≠n Kimura</button>
                    <button class="add-to-cart" data-cid="${cart.id}" data-pid="Calistemo">Agregar Macetas plasticas</button>
                    <button class="add-to-cart" data-cid="${cart.id}" data-pid="Arce">Agregar Tr√≠o de macetas</button>
                `;
                cartList.appendChild(li);
            });
        });


        socket.emit("getCarts");
    </script>
</body>
</html>
